<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <title>Energy Usage Dashboard</title>
  <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .slider-container { margin-bottom: 20px; }
    .slider-label { display: block; margin-bottom: 5px; }
    .section-title { font-weight: bold; margin-top: 30px; }
    #errorBox { color: red; margin-top: 10px; display: none; }
    #grid-weekdays, #grid-weekends { margin-top: 30px; }
    .slider-flex { display: flex; gap: 40px; flex-wrap: wrap; }
    .slider-flex > div { flex: 1; min-width: 300px; }
    #chart-container { margin-top: 40px; }
    .rate-columns { display: flex; gap: 40px; margin-top: 30px; flex-wrap: wrap; }
    .rate-column { flex: 1; min-width: 250px; }
    .rate-column h3 { margin-bottom: 10px; }
    .rate-group { margin-bottom: 15px; }
    .rate-group label { display: block; margin-bottom: 5px; }
    .rate-group input[type="range"] { width: 100%; }
    .rate-group input[type="number"] { width: 100%; }
    .lowest-price {
      border: 2px solid red;
      border-radius: 5px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>Energy Usage Dashboard</h1>

<p id="dashboardDescription" style="margin-bottom: 20px; font-size: 1rem; color: black;">
  If you live in Ontario, Canada, the electricity regulator – the Ontario Energy Board – sets 
  <a href="https://www.oeb.ca/consumer-information-and-protection/electricity-rates" target="_blank" style="color: black; text-decoration: underline;">
    your electricity rates and plans
  </a>. Electricity rates are based on two factors – how much electricity you use, and/or when you use it. 
  Each electricity plan offers different options for both factors. You have three options in 2025 – tiered rates, 
  time-of-use rates and the newest option – the Ultra-low overnight rate (ULO). The ULO rate could be cheapest 
  if you own an electric vehicle and drive a lot. The exact EV usage amount when the ULO rate is cheapest depends 
  on how much you drive and your charging requirements, i.e. when you need to charge your car. Most of my charging 
  is overnight and the ULO rate offers a significantly cheaper option for this period. However, the ULO rates include 
  periods during the evening when electricity rates are higher.
</p>

<p style="margin-top: 20px; font-size: 1rem; color: black;">
  <strong>What this page does:</strong><br>
<p id="dashboardDescription" style="margin-bottom: 20px; font-size: 1rem; color: black;">
  Use this page to estimate the cheapest electricity billing option for you. You must
  provide at least one week of electricity usage data in a CSV file. The calculations below
  use your hourly energy usage to calculate two typical days of electricity usage - a weekday
  and a weekend day. 
  In my case, I own an EV and am trying to determine whether the ULO plan is the cheapest
  option.
 </p>
 
 <p style="margin-top: 20px; font-size: 1rem; color: black;">
  <strong>⚠️ Important:</strong><br>
  The input file is NOT the Green Button format. Please use a CSV file.
</p>

<p style="margin-top: 20px; font-size: 1rem; color: black;">
  <strong>⚠️ Privacy Notice:</strong><br>
  All calculations are carried out on your computer. No data is sent either to me or to
  anyone else. This page uses CSS from <a href="https://unpkg.com/" target="_blank" style="color: black; text-decoration: underline;">UNPKG.com</a>.
  The chart uses the <a href="https://www.chartjs.org/" target="_blank" style="color: black; text-decoration: underline;">Chart.js</a> library. If you do not recognise these words, don't worry.
  No data leaves your computer and you can use this script entirely offline.
</p>



<p id="dashboardDescription" style="margin-bottom: 20px; font-size: 1rem; color: black;">
  I created this page using AI (MS Copilot). I verified that the calculations for the 
  Tiered rates are correct for summer and winter. I did not verify the calculations for
  TOU and ULO rates but the cost estimates do appear plausible.
</p>

<p style="margin-top: 20px; font-size: 1rem; color: black;">
  <strong>Instructions:</strong><br>

<ul style="margin-bottom: 20px; font-size: 1rem; color: black;">
  <li>Visit your electricity utility's website and download your usage data as a 
  CSV file. Make sure to download at least seven days of data. Save this somewhere on your computer.</li>
  <li>Below, click "Browse..." and find the energy usage CSV file on your computer.</li>
  <li>Click "Calculate".</li>
  <li>The chart below will update and show your average energy usage for a typical
  weekday and for a typical weekend day. Note that both lines in the chart represent one day each.</li>
  <li>Select the season - either winter or summer rates.</li>
  <li>Select your pricing model and click "Calculate Cost".</li>
<li>
  I designed these calculations for Ontario's electricity rates. The CSV file you download from your utility should start like this:
  <table style="margin-top: 10px; border-collapse: collapse; border: 1px solid #ccc;">
    <tr style="background-color: #f0f0f0;">
      <th style="border: 1px solid #ccc; padding: 6px;">Date</th>
      <th style="border: 1px solid #ccc; padding: 6px;">Hour 1</th>
      <th style="border: 1px solid #ccc; padding: 6px;">Hour 2</th>
      <th style="border: 1px solid #ccc; padding: 6px;">Hour 3</th>
    </tr>
    <tr>
      <td style="border: 1px solid #ccc; padding: 6px;">2025-09-01</td>
      <td style="border: 1px solid #ccc; padding: 6px;">0.42</td>
      <td style="border: 1px solid #ccc; padding: 6px;">0.38</td>
      <td style="border: 1px solid #ccc; padding: 6px;">0.45</td>
    </tr>
    <tr>
      <td style="border: 1px solid #ccc; padding: 6px;">2025-09-02</td>
      <td style="border: 1px solid #ccc; padding: 6px;">0.40</td>
      <td style="border: 1px solid #ccc; padding: 6px;">0.36</td>
      <td style="border: 1px solid #ccc; padding: 6px;">0.43</td>
    </tr>
  </table>
</li>
</ul>

<br>

 <p style="margin-top: 20px; font-size: 1rem; color: black;">
  <strong>⚠️ Not working yet:</strong><br>
  The sliders for hourly energy consumption do not work. The values at the moment are from
  your electricity usage file. The eventual idea is that you can modify these values to see how
  your electricity bill changes. For example, these should allow you to answer questions like
  "What if I charged my car starting at 11 PM instead of 7 PM". At the moment, these sliders do nothing.
</p>

<br>

<p style="margin-top: 20px; font-size: 1rem; color: black;">
  <strong>Input - Your electricity usage file goes here:</strong><br>

  <input type="file" id="csvFile" accept=".csv">
  <button onclick="processCSV()">Calculate</button>
  <div id="errorBox"></div>

  <div class="rate-columns">
    <div class="rate-column" id="tou-container">
      <h3>Time-of-Use Rates</h3>
      <label for="touSeason">Season:</label>
      <select id="touSeason">
        <option value="summer">Summer</option>
        <option value="winter">Winter</option>
      </select>
      <div class="rate-group">
        <label>Off-Peak (¢/kWh)</label>
        <input type="range" id="touOffPeak" min="0" max="200" value="8.7" step="0.1">
        <input type="number" id="touOffPeakVal" value="8.7" step="0.1">
      </div>
      <div class="rate-group">
        <label>Mid-Peak (¢/kWh)</label>
        <input type="range" id="touMidPeak" min="0" max="200" value="12.2" step="0.1">
        <input type="number" id="touMidPeakVal" value="12.2" step="0.1">
      </div>
      <div class="rate-group">
        <label>On-Peak (¢/kWh)</label>
        <input type="range" id="touOnPeak" min="0" max="200" value="18.2" step="0.1">
        <input type="number" id="touOnPeakVal" value="18.2" step="0.1">
      </div>
      <div id="touCostDisplay" style="margin-top: 10px; font-weight: bold;"></div>
    </div>

    <div class="rate-column" id="tiered-container">
      <h3>Tiered Prices</h3>
      <label for="tierSeason">Tiered Season:</label>
      <select id="tierSeason">
        <option value="summer">Summer</option>
        <option value="winter">Winter</option>
      </select>
      <div class="rate-group">
        <label>Tier 1 (¢/kWh)</label>
        <input type="range" id="tier1" min="0" max="200" value="10.3" step="0.1">
        <input type="number" id="tier1Val" value="10.3" step="0.1">
      </div>
      <div class="rate-group">
        <label>Tier 2 (¢/kWh)</label>
        <input type="range" id="tier2" min="0" max="200" value="12.5" step="0.1">
        <input type="number" id="tier2Val" value="12.5" step="0.1">
      </div>
      <div id="tieredCostDisplay" style="margin-top: 10px; font-weight: bold;"></div>
    </div>

    <div class="rate-column" id="ulo-container">
      <h3>Ultra-Low Overnight</h3>
      <div class="rate-group">
        <label>ULO (¢/kWh)</label>
        <input type="range" id="uloRate" min="0" max="200" value="2.8" step="0.1">
        <input type="number" id="uloRateVal" value="2.8" step="0.1">
      </div>
      <div class="rate-group">
        <label>Off-Peak (¢/kWh)</label>
        <input type="range" id="uloOffPeak" min="0" max="200" value="8.7" step="0.1">
        <input type="number" id="uloOffPeakVal" value="8.7" step="0.1">
      </div>
      <div class="rate-group">
        <label>Mid-Peak (¢/kWh)</label>
        <input type="range" id="uloMidPeak" min="0" max="200" value="12.2" step="0.1">
        <input type="number" id="uloMidPeakVal" value="12.2" step="0.1">
      </div>
      <div class="rate-group">
        <label>On-Peak (¢/kWh)</label>
        <input type="range" id="uloOnPeak" min="0" max="200" value="18.2" step="0.1">
        <input type="number" id="uloOnPeakVal" value="18.2" step="0.1">
      </div>
      <div id="uloCostDisplay" style="margin-top: 10px; font-weight: bold;"></div>
    </div>
  </div>

  <div id="chart-container">
    <canvas id="energyChart" width="400" height="200"></canvas>
  </div>

  <div class="section-title">Hourly Averages</div>
  <div class="slider-flex">
    <div>
      <h3>Weekday</h3>
      <div id="weekday-sliders" class="slider-container"></div>
    </div>
    <div>
      <h3>Weekend</h3>
      <div id="weekend-sliders" class="slider-container"></div>
    </div>
  </div>

  <div class="section-title">Weekdays Table</div>
  <div id="grid-weekdays"></div>

  <div class="section-title">Weekends Table</div>
  <div id="grid-weekends"></div>

<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
<script>
  const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  const hourLabels = Array.from({ length: 24 }, (_, i) => `${String(i).padStart(2, '0')}:00`);
  let energyChart;
  let weekdayData = Array(24).fill(0).map(() => []);
  let weekendData = Array(24).fill(0).map(() => []);

  const weekdaySliders = document.getElementById('weekday-sliders');
  const weekendSliders = document.getElementById('weekend-sliders');

  for (let i = 1; i <= 24; i++) {
    const hourLabel = `${String(i).padStart(2, '0')}:00`;

    const weekdayDiv = document.createElement('div');
    weekdayDiv.innerHTML = `
      <label class="slider-label">Weekday ${hourLabel}</label>
      <input type="range" min="0" max="10" step="0.01" value="0" id="weekday-${i}">
      <span id="weekday-val-${i}">0</span>
    `;
    weekdaySliders.appendChild(weekdayDiv);

    const weekendDiv = document.createElement('div');
    weekendDiv.innerHTML = `
      <label class="slider-label">Weekend ${hourLabel}</label>
      <input type="range" min="0" max="10" step="0.01" value="0" id="weekend-${i}">
      <span id="weekend-val-${i}">0</span>
    `;
    weekendSliders.appendChild(weekendDiv);
  }
  
  function updateAllCalculations() {
    updateFromSliders();
    calculateAndDisplayCosts();
  }

  function updateFromSliders() {
    const weekdayAverages = [];
    const weekendAverages = [];

    for (let h = 1; h <= 24; h++) {
      const weekdayValue = parseFloat(document.getElementById(`weekday-${h}`).value);
      const weekendValue = parseFloat(document.getElementById(`weekend-${h}`).value);
      weekdayAverages.push(weekdayValue);
      weekendAverages.push(weekendValue);
      document.getElementById(`weekday-val-${h}`).textContent = weekdayValue.toFixed(2);
      document.getElementById(`weekend-val-${h}`).textContent = weekendValue.toFixed(2);
    }
    
    if (energyChart) {
      energyChart.data.datasets[0].data = weekdayAverages;
      energyChart.data.datasets[1].data = weekendAverages;
      energyChart.update();
    } else {
      const ctx = document.getElementById('energyChart').getContext('2d');
      energyChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: hourLabels,
              datasets: [
                  {
                      label: 'Weekday Average',
                      data: weekdayAverages,
                      borderColor: 'red',
                      fill: false,
                      tension: 0.3
                  },
                  {
                      label: 'Weekend Average',
                      data: weekendAverages,
                      borderColor: 'green',
                      fill: false,
                      tension: 0.3
                  }
              ]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true,
                      title: {
                          display: true,
                          text: 'Average Energy Consumption (kWh)'
                      }
                  },
                  x: {
                      title: {
                          display: true,
                          text: 'Hour of Day'
                      }
                  }
              }
          }
      });
    }
  }
  
  function updateSlidersFromData(weekdayAverages, weekendAverages) {
      for (let h = 0; h < 24; h++) {
          document.getElementById(`weekday-${h + 1}`).value = weekdayAverages[h];
          document.getElementById(`weekend-${h + 1}`).value = weekendAverages[h];
      }
      updateAllCalculations();
  }
  
  document.querySelectorAll('input[type="range"]').forEach(slider => {
      slider.addEventListener('input', updateAllCalculations);
  });

  function syncSlider(sliderId, inputId) {
    const slider = document.getElementById(sliderId);
    const input = document.getElementById(inputId);
    slider.addEventListener('input', () => {
        input.value = slider.value;
        calculateAndDisplayCosts();
    });
    input.addEventListener('input', () => {
        slider.value = input.value;
        calculateAndDisplayCosts();
    });
  }

  ['touOffPeak', 'touMidPeak', 'touOnPeak',
   'tier1', 'tier2',
   'uloRate', 'uloOffPeak', 'uloOffPeak', 'uloOnPeak'].forEach(id => {
    syncSlider(id, id + 'Val');
  });

  const tierRates = {
    summer: { threshold: 600, tier1: 10.3, tier2: 12.5 },
    winter: { threshold: 1000, tier1: 10.3, tier2: 12.5 }
  };

  document.getElementById('touSeason').addEventListener('change', calculateAndDisplayCosts);
  document.getElementById('tierSeason').addEventListener('change', calculateAndDisplayCosts);

  function average(arr) {
    if (arr.length === 0) return 0;
    return arr.reduce((a, b) => a + b, 0) / arr.length;
  }

  function processCSV() {
    const fileInput = document.getElementById('csvFile');
    if (!fileInput.files.length) {
      alert('Please upload a CSV file.');
      return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
      const text = e.target.result;
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',');

      if (headers.length !== 25) {
        document.getElementById('errorBox').textContent = 'Error: CSV must have exactly 25 columns.';
        document.getElementById('errorBox').style.display = 'block';
        return;
      } else {
        document.getElementById('errorBox').style.display = 'none';
      }

      weekdayData = Array(24).fill(0).map(() => []);
      weekendData = Array(24).fill(0).map(() => []);
      const weekdayRows = [];
      const weekendRows = [];

      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(',');
        if (cols.length !== 25) continue;

        const [year, month, day] = cols[0].split('-').map(Number);
        const date = new Date(year, month - 1, day);
        const dayIndex = date.getDay();
        const dayName = dayNames[dayIndex];
        const isWeekend = (dayIndex === 0 || dayIndex === 6);
        const typeLabel = isWeekend ? 'Weekend' : 'Weekday';

        const row = [cols[0], dayName, typeLabel, ...cols.slice(1)];
        if (isWeekend) weekendRows.push(row);
        else weekdayRows.push(row);

        for (let h = 0; h < 24; h++) {
          const val = parseFloat(cols[h + 1]);
          if (!isNaN(val)) {
            if (isWeekend) weekendData[h].push(val);
            else weekdayData[h].push(val);
          }
        }
      }

      const weekdayAverages = weekdayData.map(average);
      const weekendAverages = weekendData.map(average);

      updateSlidersFromData(weekdayAverages, weekendAverages);
      
      const extendedHeaders = ['Date', 'Day of Week', 'Type', ...headers.slice(1)];
      document.getElementById('grid-weekdays').innerHTML = '';
      document.getElementById('grid-weekends').innerHTML = '';

      new gridjs.Grid({
        columns: extendedHeaders,
        data: weekdayRows,
        pagination: true,
        search: true,
        sort: true
      }).render(document.getElementById('grid-weekdays'));

      new gridjs.Grid({
        columns: extendedHeaders,
        data: weekendRows,
        pagination: true,
        search: true,
        sort: true
      }).render(document.getElementById('grid-weekends'));
    };
    reader.readAsText(fileInput.files[0]);
  }
</script>

<script>
function calculateAndDisplayCosts() {
  const weekdayAverages = [];
  const weekendAverages = [];
  for (let h = 1; h <= 24; h++) {
    weekdayAverages.push(parseFloat(document.getElementById(`weekday-${h}`).value));
    weekendAverages.push(parseFloat(document.getElementById(`weekend-${h}`).value));
  }

  // Calculate and display for Time-of-Use
  let totalCostTOU = 0;
  let costDetailsTOU = '';
  const touSeason = document.getElementById('touSeason').value;
  const touOff = parseFloat(document.getElementById('touOffPeak').value) / 100;
  const touMid = parseFloat(document.getElementById('touMidPeak').value) / 100;
  const touOn = parseFloat(document.getElementById('touOnPeak').value) / 100;
  let weekdayTOU = { off: 0, mid: 0, on: 0 };
  let weekendTOU = { off: 0, mid: 0, on: 0 };
  for (let h = 0; h < 24; h++) {
    const val = weekdayAverages[h];
    if (touSeason === 'summer') {
      if (h >= 11 && h < 17) weekdayTOU.on += val;
      else if ((h >= 7 && h < 11) || (h >= 17 && h < 19)) weekdayTOU.mid += val;
      else weekdayTOU.off += val;
    } else {
      if ((h >= 7 && h < 11) || (h >= 17 && h < 19)) weekdayTOU.on += val;
      else if (h >= 11 && h < 17) weekdayTOU.mid += val;
      else weekdayTOU.off += val;
    }
  }
  for (let h = 0; h < 24; h++) {
    const val = weekendAverages[h];
    weekendTOU.off += val;
  }
  const weeklyTOU = {
    off: weekdayTOU.off * 5 + weekendTOU.off * 2,
    mid: weekdayTOU.mid * 5,
    on: weekdayTOU.on * 5
  };
  const monthlyTOU = {
    off: weeklyTOU.off * 4,
    mid: weeklyTOU.mid * 4,
    on: weeklyTOU.on * 4
  };
  totalCostTOU = monthlyTOU.off * touOff + monthlyTOU.mid * touMid + monthlyTOU.on * touOn;
  costDetailsTOU =
    `Average Weekday Energy: ${(weekdayTOU.off + weekdayTOU.mid + weekdayTOU.on).toFixed(2)} kWh<br>` +
    `Average Weekend Energy: ${weekendTOU.off.toFixed(2)} kWh<br>` +
    `Monthly Energy Estimate: ${(monthlyTOU.off + monthlyTOU.mid + monthlyTOU.on).toFixed(2)} kWh<br><br>` +
    `Monthly Off-Peak: ${monthlyTOU.off.toFixed(2)} kWh × ${touOff.toFixed(2)} = $${(monthlyTOU.off * touOff).toFixed(2)}<br>` +
    `Monthly Mid-Peak: ${monthlyTOU.mid.toFixed(2)} kWh × ${touMid.toFixed(2)} = $${(monthlyTOU.mid * touMid).toFixed(2)}<br>` +
    `Monthly On-Peak: ${monthlyTOU.on.toFixed(2)} kWh × ${touOn.toFixed(2)} = $${(monthlyTOU.on * touOn).toFixed(2)}`;
  document.getElementById('touCostDisplay').innerHTML = `<strong>Estimated Monthly Cost: $${totalCostTOU.toFixed(2)}</strong><br><br><strong>Breakdown:</strong><br>${costDetailsTOU}`;

  // Calculate and display for Tiered
  let totalCostTiered = 0;
  let costDetailsTiered = '';
  const tierSeason = document.getElementById('tierSeason').value;
  const threshold = tierRates[tierSeason].threshold;
  const tier1 = parseFloat(document.getElementById('tier1').value) / 100;
  const tier2 = parseFloat(document.getElementById('tier2').value) / 100;
  const weekdayTotal = weekdayAverages.reduce((a, b) => a + b, 0);
  const weekendTotal = weekendAverages.reduce((a, b) => a + b, 0);
  const avgWeekdayEnergy = weekdayTotal;
  const avgWeekendEnergy = weekendTotal;
  const weeklyEnergy = avgWeekdayEnergy * 5 + avgWeekendEnergy * 2;
  const monthlyEnergy = weeklyEnergy * 4;
  let tierDetails = '';
  if (monthlyEnergy <= threshold) {
    totalCostTiered = monthlyEnergy * tier1;
    tierDetails = `Tier 1: ${monthlyEnergy.toFixed(2)} kWh × ${tier1.toFixed(2)} = $${totalCostTiered.toFixed(2)}`;
  } else {
    const tier1Usage = threshold;
    const tier2Usage = monthlyEnergy - threshold;
    const tier1Cost = tier1Usage * tier1;
    const tier2Cost = tier2Usage * tier2;
    totalCostTiered = tier1Cost + tier2Cost;
    tierDetails =
      `Tier 1: ${tier1Usage.toFixed(2)} kWh × ${tier1.toFixed(2)} = $${tier1Cost.toFixed(2)}<br>` +
      `Tier 2: ${tier2Usage.toFixed(2)} kWh × ${tier2.toFixed(2)} = $${tier2Cost.toFixed(2)}`;
  }
  costDetailsTiered =
    `Average Weekday Energy: ${avgWeekdayEnergy.toFixed(2)} kWh<br>` +
    `Average Weekend Energy: ${avgWeekendEnergy.toFixed(2)} kWh<br>` +
    `Monthly Energy Estimate: ${monthlyEnergy.toFixed(2)} kWh<br><br>` +
    tierDetails;
  document.getElementById('tieredCostDisplay').innerHTML = `<strong>Estimated Monthly Cost: $${totalCostTiered.toFixed(2)}</strong><br><br><strong>Breakdown:</strong><br>${costDetailsTiered}`;

  // Calculate and display for Ultra-Low Overnight
  let totalCostULO = 0;
  let costDetailsULO = '';
  const ulo = parseFloat(document.getElementById('uloRate').value) / 100;
  const off = parseFloat(document.getElementById('uloOffPeak').value) / 100;
  const mid = parseFloat(document.getElementById('uloMidPeak').value) / 100;
  const on = parseFloat(document.getElementById('uloOnPeak').value) / 100;
  let weekdayULO = { ulo: 0, off: 0, mid: 0, on: 0 };
  let weekendULO = { ulo: 0, off: 0, mid: 0, on: 0 };
  for (let h = 0; h < 24; h++) {
    const val = weekdayAverages[h];
    if (h >= 0 && h < 7) {
      weekdayULO.ulo += val;
    } else if ((h >= 7 && h < 16) || (h >= 21 && h < 24)) {
      weekdayULO.mid += val;
    } else if (h >= 16 && h < 21) {
      weekdayULO.on += val;
    } else {
      weekdayULO.off += val;
    }
  }
  for (let h = 0; h < 24; h++) {
    const val = weekendAverages[h];
    weekendULO.off += val;
  }
  const weeklyULO = {
    ulo: weekdayULO.ulo * 5,
    off: weekdayULO.off * 5 + weekendULO.off * 2,
    mid: weekdayULO.mid * 5,
    on: weekdayULO.on * 5
  };
  const monthlyULO = {
    ulo: weeklyULO.ulo * 4,
    off: weeklyULO.off * 4,
    mid: weeklyULO.mid * 4,
    on: weeklyULO.on * 4
  };
  totalCostULO =
    monthlyULO.ulo * ulo +
    monthlyULO.off * off +
    monthlyULO.mid * mid +
    monthlyULO.on * on;
  costDetailsULO =
    `Average Weekday Energy: ${(weekdayULO.ulo + weekdayULO.off + weekdayULO.mid + weekdayULO.on).toFixed(2)} kWh<br>` +
    `Average Weekend Energy: ${weekendULO.off.toFixed(2)} kWh<br>` +
    `Monthly Energy Estimate: ${(monthlyULO.ulo + monthlyULO.off + monthlyULO.mid + monthlyULO.on).toFixed(2)} kWh<br><br>` +
    `Monthly ULO: ${monthlyULO.ulo.toFixed(2)} kWh × ${ulo.toFixed(2)} = $${(monthlyULO.ulo * ulo).toFixed(2)}<br>` +
    `Monthly Off-Peak: ${monthlyULO.off.toFixed(2)} kWh × ${off.toFixed(2)} = $${(monthlyULO.off * off).toFixed(2)}<br>` +
    `Monthly Mid-Peak: ${monthlyULO.mid.toFixed(2)} kWh × ${mid.toFixed(2)} = $${(monthlyULO.mid * mid).toFixed(2)}<br>` +
    `Monthly On-Peak: ${monthlyULO.on.toFixed(2)} kWh × ${on.toFixed(2)} = $${(monthlyULO.on * on).toFixed(2)}`;
  document.getElementById('uloCostDisplay').innerHTML = `<strong>Estimated Monthly Cost: $${totalCostULO.toFixed(2)}</strong><br><br><strong>Breakdown:</strong><br>${costDetailsULO}`;
  
  // Logic to find the lowest price and add a red border
  const costs = {
    'tou-container': totalCostTOU,
    'tiered-container': totalCostTiered,
    'ulo-container': totalCostULO
  };
  const containers = document.querySelectorAll('.rate-column');
  let lowestCost = Infinity;
  let lowestCostId = '';

  for (const id in costs) {
    if (costs[id] < lowestCost) {
      lowestCost = costs[id];
      lowestCostId = id;
    }
  }

  containers.forEach(container => {
    container.classList.remove('lowest-price');
  });

  if (lowestCostId) {
    document.getElementById(lowestCostId).classList.add('lowest-price');
  }
}

</script>
</body>
</html>
